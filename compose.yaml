services:
  php:
    build:
      context: docker
      args:
        USER_ID: ${UID:-1000}
        GROUP_ID: ${GID:-1000}
    container_name: php
    volumes:
      # Monte le dossier du projet (sur ta machine) dans /var/www/html (dans le conteneur) :
      # PHP et Nginx voient le même code, et les changements locaux sont immédiats (dev).
      - .:/var/www/html
    depends_on:
      - mariadb

  nginx:
    image: nginx:alpine
    container_name: nginx
    ports:
      - "8080:80"
    volumes:
      # Même montage du code pour que Nginx serve les fichiers du projet.
      - .:/var/www/html
      # Remplace la conf Nginx du conteneur par ton fichier local (config versionnée et modifiable facilement).
      - ./docker/nginx.conf:/etc/nginx/conf.d/default.conf
    depends_on:
      - php

  mariadb:
    image: mariadb:10.11
    container_name: mariadb
    environment:
      - MYSQL_ROOT_PASSWORD=pwd
      - MYSQL_DATABASE=api_db
    ports:
      - "3307:3306"
    volumes:
      # Volume Docker nommé pour persister les données MariaDB (/var/lib/mysql) même si le conteneur est recréé.
      - mariadb_data:/var/lib/mysql

volumes:
  # Déclare le volume nommé utilisé par mariadb (stockage persistant géré par Docker).
  mariadb_data:
